<html>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		var socket = io();
		var countdownInterval;

		socket.on('start', function(msg){
			document.getElementById('ready').style.display = 'none';
			document.getElementById('roomOccupied').style.display = 'none';
			document.getElementById('readyMsg').style.display = 'none';
			document.getElementById('roomname').style.display = 'none';

			document.getElementById('charge').style.display = 'inline';
			document.getElementById('hit').style.display = 'inline';
			document.getElementById('defend').style.display = 'inline';
			document.getElementById('countdown').style.display = 'inline';

			countdown();
		});

		socket.on('back_to_ready', function(isRoomnameUsed, msg){
			document.getElementById('charge').style.display = 'none';
			document.getElementById('hit').style.display = 'none';
			document.getElementById('defend').style.display = 'none';
			document.getElementById('end').style.display = 'none';
			document.getElementById('continue').style.display = 'none';
			document.getElementById('remaining_charge').style.display = 'none';
			document.getElementById('readyMsg').style.display = 'none';
			document.getElementById("roomname").value = '';
			document.getElementById('roomOccupied').style.display = 'none';
			document.getElementById('countdown').style.display = 'none';
			
			document.getElementById('ready').style.display = 'inline';
			document.getElementById('roomname').style.display = 'inline';

			if(isRoomnameUsed){
				document.getElementById('roomOccupied').style.display = 'inline';

				if(msg != "") document.getElementById('roomOccupied').innerHTML = msg;
				else document.getElementById('roomOccupied').innerHTML = 'the roomname has been used!\n';
				
			}
		});

		socket.on('enable_hit', function(msg){
			document.getElementById('hit').disabled = false;
		});

		socket.on('disable_hit', function(msg){
			document.getElementById('hit').disabled = true;
		});

		socket.on('end', function(msg){
			document.getElementById('charge').style.display = 'none';
			document.getElementById('hit').style.display = 'none';
			document.getElementById('defend').style.display = 'none';
			document.getElementById('continue').style.display = 'none';
			document.getElementById('countdown').style.display = 'none';

			document.getElementById('end').style.display = 'inline';
			document.getElementById('end').innerHTML = msg;
		});

		socket.on('continue', function(msg, remaining_charge){
			document.getElementById('continue').style.display = 'inline';
			document.getElementById('remaining_charge').style.display = 'inline';
			document.getElementById('countdown').style.display = 'inline';

			document.getElementById('continue').innerHTML = msg;
			document.getElementById('remaining_charge').innerHTML = " Remaining charge: " + remaining_charge + "!\n";

			countdown();
		});

		socket.on('ready', function(){
			document.getElementById('roomOccupied').style.display = 'none';

			document.getElementById('readyMsg').style.display = 'inline';
			document.getElementById('readyMsg').innerHTML = "wait for the other roomplayer get ready!\n";
		});

		function ready(){
			socket.emit('ready', document.getElementById("roomname").value);
		}

		function countdown(){
			var counter = 5;
			countdownInterval = setInterval(function(){
				document.getElementById('countdown').innerHTML = "Timer: " + counter + "!\n Please select next step!\n";
				counter--;
				if(counter < 0){
					clearInterval(countdownInterval);
					socket.emit('select', 'charge');
				}
			});
		}

		function select(selection){
			clearInterval(countdownInterval);
			document.getElementById('countdown').innerHTML = "";
			document.getElementById('countdown').style.display = 'none';
			socket.emit('select', selection);
		}
	</script>
	<body>
		<input type="text" id="roomname" name="Room name">
		<button id="ready" onclick="ready()">
			Ready
		</button>
		<button id="charge" onclick="select('charge')" style="display:none;">
			Charge
		</button>
		<button id="hit" onclick="select('hit')" style="display:none;" disabled>
			Hit
		</button>
		<button id="defend" onclick="select('defend')" style="display:none;">
			Defend
		</button>
		<p id="remaining_charge" style="display:none;"></p>
		<p id="end" style="display:none;"></p>
		<p id="continue" style="display:none;"></p>
		<p id="readyMsg" style="display:none;"></p>
		<p id="roomOccupied" style="display:none;"></p>
		<p id="countdown" style="display:none;"></p>
	</body>
</html>