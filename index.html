<html>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		var socket = io();
		var countdownInterval;

		socket.on('start', function(msg){
			document.getElementById('ready').style.display = 'none';
			document.getElementById('roomOccupied').style.display = 'none';
			document.getElementById('readyMsg').style.display = 'none';
			document.getElementById('roomname').style.display = 'none';

			document.getElementById('charge').style.display = 'inline';
			document.getElementById('hit').style.display = 'inline';
			document.getElementById('defend').style.display = 'inline';
			document.getElementById('countdown').style.display = 'inline';
			// console.log('server sent me ' + msg);
			countdown();
		});

		socket.on('back_to_ready', function(msg){
			document.getElementById('charge').style.display = 'none';
			document.getElementById('hit').style.display = 'none';
			document.getElementById('defend').style.display = 'none';
			document.getElementById('end').style.display = 'none';
			document.getElementById('continue').style.display = 'none';
			document.getElementById('remaining_charge').style.display = 'none';
			document.getElementById('readyMsg').style.display = 'none';
			document.getElementById("roomname").value = '';
			document.getElementById('roomOccupied').style.display = 'none';
			document.getElementById('countdown').style.display = 'none';
			
			document.getElementById('ready').style.display = 'inline';
			document.getElementById('roomname').style.display = 'inline';
			
			document.getElementById('roomOccupied').innerHTML = msg;
			document.getElementById('roomOccupied').style.display = 'inline';
			// console.log('server sent me ' + msg);
		});

		socket.on('enable_hit', function(msg){
			document.getElementById('hit').disabled = false;
			// console.log('server sent me ' + msg);
		});

		socket.on('disable_hit', function(msg){
			document.getElementById('hit').disabled = true;
			// console.log('server sent me ' + msg);
		});

		socket.on('end', function(msg){
			document.getElementById('charge').style.display = 'none';
			document.getElementById('hit').style.display = 'none';
			document.getElementById('defend').style.display = 'none';
			document.getElementById('continue').style.display = 'none';
			document.getElementById('countdown').style.display = 'none';

			document.getElementById('end').style.display = 'inline';
			document.getElementById('end').innerHTML = msg;
			// console.log('server sent me ' + msg);
		});

		socket.on('continue', function(msg, remaining_charge){
			document.getElementById('continue').style.display = 'inline';
			document.getElementById('continue').innerHTML = msg;
			document.getElementById('remaining_charge').style.display = 'inline';
			document.getElementById('remaining_charge').innerHTML = " Remaining charge: " + remaining_charge + "!";
			// console.log('server sent me ' + msg);
			countdown();
		});

		socket.on('ready', function(){
			document.getElementById('roomOccupied').style.display = 'none';

			document.getElementById('readyMsg').innerHTML = "wait for the other roomplayer get ready!";
			document.getElementById('readyMsg').style.display = 'inline';
		});

		function ready(){
			socket.emit('ready', document.getElementById("roomname").value);
		}

		function countdown(){
			var counter = 5;
			countdownInterval = setInterval(function(){
				document.getElementById("countdown").innerHTML = "Timer: " + counter + "! Select next step!";
				counter--;
				if(counter < 0){
					clearInterval(countdownInterval);
					socket.emit('select', 'charge');
				}
			}, 1000);
		}
	</script>
	<body>
		<input type="text" id="roomname" name="Room name">
		<button id="ready" onclick="ready()">
			Ready
		</button>
		<button id="charge" onclick="clearInterval(countdownInterval); socket.emit('select', 'charge')" style="display:none;">
			Charge
		</button>
		<button id="hit" onclick="clearInterval(countdownInterval); socket.emit('select', 'hit')" style="display:none;" disabled>
			Hit
		</button>
		<button id="defend" onclick="clearInterval(countdownInterval); socket.emit('select', 'defend')" style="display:none;">
			Defend
		</button>
		<p id="remaining_charge" style="display:none;"></p>
		<p id="end" style="display:none;"></p>
		<p id="continue" style="display:none;"></p>
		<p id="readyMsg" style="display:none;"></p>
		<p id="roomOccupied" style="display:none;"></p>
		<p id="countdown" style="display:none;"></p>
	</body>
</html>